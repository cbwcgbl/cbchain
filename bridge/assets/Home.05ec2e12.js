import{d as e,_ as a,u as s,c as l,t,g as o,r as n,w as i,s as r,a as u,f as c,b as d,i as m,e as v,h,j as b,k as p,l as f,m as g,n as k,o as y,p as w,B as T,N as C,q as N,v as x,x as M,y as A,z as H,A as I,C as L,D as B,E,F as $,G as q,H as S,I as U,J as _,K as D,L as P,M as J,O,P as j,Q as W}from"./index.91959083.js";import{_ as F}from"./no-data.d1244a8f.js";var G=e({name:"Home",components:{ModelBridge:a},setup(){const{t:e}=s(),{getLang:a}=B(),E=l((()=>a())),$=t(o,"type"),q=t(o,"address"),S=t(o,"isMobile"),U=t(o,"balance"),_=t(o,"assetName"),D=t(o,"transfer"),P=t(o,"walletModal"),J=t(o,"historyList"),O=n({symbol:"",eth:{decimal:18,frontDecimals:6,minAmount:"",maxAmount:"",fee:"",token:""},cube:{decimal:18,frontDecimals:6,minAmount:"",maxAmount:"",fee:"",token:""},icon:""}),j=n(""),W=n(""),F=n({}),G=n(!1),V=n(!1),z=n(!1),K=n(!1),Q=n(!1),R=n(!1),X=n(!1),Y=n(!1),Z=n(""),ee=l((()=>{var e;const a=null==(e=Z.value)?void 0:e.toUpperCase();return L.filter((e=>a?e.symbol.includes(a)&&("in"==$.value?e.eth:e.cube):"in"==$.value?e.eth:e.cube))})),ae=l((()=>!!(q.value&&(!+j.value||G.value||W.value)||q.value&&"in"==$.value&&!m.value||"out"==$.value&&!b.value||q.value&&!_.value)));i(_,(e=>{const a=L.find((a=>a.symbol==e));a&&(O.value=a)}),{immediate:!0});const se=l((()=>O.value?"in"==$.value?v:h:"")),le=l((()=>m.value?O.value&&O.value.eth:O.value&&O.value.cube)),te=l((()=>!(!q.value||!("in"==$.value&&m.value||"out"==$.value&&b.value)))),oe=l((()=>{if(m.value&&O.value){const e=O.value.eth,a=`${d(e.fee,e.decimal)}`;return I(j.value,a)}if(b.value&&O.value){const e=O.value.cube,a=`${d(e.fee,e.decimal)}`;return I(j.value,a)}return Number(j.value)})),ne=()=>{var e;if(/^0[0-9]/.test(j.value))j.value="0";else{const a=(null==(e=null==le?void 0:le.value)?void 0:e.frontDecimals)||18,s=new RegExp(`^\\D*(\\d*(?:\\.\\d{0,${a}})?).*$`,"g");j.value=j.value.replace(s,"$1")}ie()},ie=()=>{var e,a,s,l;const t=j.value&&new T(j.value),o=null==(e=le.value)?void 0:e.decimal,n=d(null==(a=null==le?void 0:le.value)?void 0:a.maxAmount,o),i=d(null==(s=null==le?void 0:le.value)?void 0:s.minAmount,o),r=d(null==(l=le.value)?void 0:l.fee,o);F.value={maxTips:{max:n,assetName:_.value},minTips:{min:i,assetName:_.value},feeTips:{},notEnough:{}},le.value&&le.value.maxAmount&&t&&t.gt(new T(n))?W.value="maxTips":le.value&&le.value.minAmount&&t&&t.lt(new T(i))?W.value="minTips":le.value&&le.value.fee&&t&&t.lte(new T(r))?W.value="feeTips":(m.value||b.value)&&t&&t.gt(U.value)?W.value="notEnough":W.value=""},re=()=>{V.value=!1,Z.value=""},ue=()=>{Y.value=!1,z.value=!1,j.value="",W.value="",F.value={}},ce=()=>{K.value=!1},de=async(a,s,l,t)=>{let o,n;console.log("tokenName:",s),"out"===$.value?(o="cube",n="eth"):(o="eth",n="cube");const i={depositAmount:a,depositHash:l,destChain:n,fee:d(le.value.fee,le.value.decimal),sourceChain:o,sourceToken:s,status:1,timestamp:Math.floor(Date.now()/1e3),withdrawHash:""};J.value[l]=i;const r=localStorage.getItem("newHistory");if(r){const e=JSON.parse(r);e[l]=i,localStorage.setItem("newHistory",JSON.stringify(e))}else localStorage.setItem("newHistory",JSON.stringify(J.value));const u=y();(await u.waitForTransaction(l)).blockNumber&&(R.value=!1,C.success({title:e("common.notice"),message:e("common.transaction")}),j.value="",t.close(),N())};return{t:e,type:$,isMobile:S,showMain:r,btnDisabled:ae,changeType:()=>{if(!q.value)return void(P.value=!0);const e="in"===$.value?"out":"in";("in"==e&&!m.value||"out"==e&&!b.value)&&(D.value=!0,P.value=!0,S.value||(j.value="",W.value="",F.value={}))},address:q,balance:U,handleInput:ne,number:j,handleNext:async()=>{if(q.value&&j.value){if(!(!!S.value||await p()))return f.value=!0,void(g.value="unlock");z.value=!0}else k()},allBalance:async()=>{var a,s;if(le.value)if(m.value&&"ETH"==(null==(a=null==O?void 0:O.value)?void 0:a.symbol)||b.value&&"CUBE"==(null==(s=null==O?void 0:O.value)?void 0:s.symbol)){const a=y(),s=await a.getGasPrice(),l=w.fromWei(s.toString()),t=new T(l).times(3e4),o=new T(U.value).minus(t);o.lt(0)?C.warning({title:e("common.notice"),message:e("home.notEnough")}):(j.value=o.toString(),ne())}else j.value=U.value,ne()},showAddressTips:G,showConnect:te,numberTips:W,checkNumber:ie,assetModal:V,bridgeModal:z,transferModal:K,showAssetModal:()=>{V.value=!0},tokenName:Z,tokenImg:se,chooseToken:e=>{_.value=e,j.value="",W.value="",re(),q.value&&N()},handleClose:re,handleCloseBridge:ue,handleCloseTransfer:ce,tokenList:ee,assetName:_,assetInfo:O,compressAddress:u,toHistory:e=>{(e&&e.target&&"SPAN"==e.target.nodeName||null==e)&&(ce(),x.push("/history"))},crossChain:async()=>{Y.value=!0;const a=j.value,s=_.value,{token:l,decimal:t}=le.value,{data:o}=await M(l,A(a,t)).catch((e=>{console.log("检查数量限制出错：",e)}));if(!o||!0!==o.allowSenderLimit)return f.value=!0,g.value="overTokenLimit",void ue();console.log("sendTransaction:",a);const n=await H({to:q.value,amount:a}).catch((e=>(console.log("crossChain交易报错：",e),{hash:"",data:""})));if(n.hash){R.value=!0,U.value=`${I(U.value,a)}`;const l=m.value?e("app.viewEth",{url:"https://etherscan.io",hash:n.hash}):e("app.viewHscan",{url:"https://www.cubescan.network/en-us",hash:n.hash}),t=C.info({title:e("app.transfer"),dangerouslyUseHTMLString:!0,duration:0,message:l});de(a,s,n.hash,t),ue(),K.value=!0}else console.log("未拿到tx.hash值：",n),Y.value=!1,C.error({title:e("common.notice"),message:e("app.cancel")})},subLoading:Y,isNeedApprove:Q,formatBalance:c,formatUnits:d,lang:E,isWait:R,isEthereum:m,getTotal:oe,isBtnLoaded:X,currentToken:le,defaultEthImg:v,defaultCubeImg:h,numberTipsParams:F}}});const V={class:"main home-main"},z={key:0,class:"home-container"},K={class:"home-left"},Q={class:"home-title"},R={class:"home-question"},X={class:"home-question-item flex-top"},Y={href:"https://docs.cube.network/#/Announcement?id=the-latest-announcement",target:"_blank",class:"home-question-link",rel:"noopener noreferrer"},Z={class:"home-question-item flex-top mt-16"},ee={href:"https://www.cube.network/solutions.html",target:"_blank",class:"home-question-link",rel:"noopener noreferrer"},ae={class:"home-question-item flex-top mt-16"},se={href:"mailto:contact@cube.network",target:"_blank",rel:"noopener noreferrer",class:"home-question-link"},le={class:"home-contract"},te=S("div",{class:"safe"},[S("img",{src:"/bridge/assets/safe.df1884c9.svg",alt:"safe"})],-1),oe={class:"home-right"},ne={class:"bridgeTip"},ie={class:"bridge-top"},re={class:"bridge-select"},ue={class:"bridge-top-balance"},ce={class:"bridge-bottom"},de={class:"bridge-bottom-input hb-form-input"},me={key:0,class:"input-error-tips"},ve={key:1,class:"input-error-tips-wrapper"},he=S("i",null,null,-1),be=S("i",{class:"select-icon"},null,-1),pe={class:"bridge bridgeBottom"},fe={class:"bridge-top"},ge={class:"bridge-select"},ke={class:"bridge-bottom"},ye={class:"bridge-bottom-result"},we={class:"result"},Te={class:"result-fee"},Ce={class:"result-adress"},Ne={key:0,class:"hb-button loading"},xe=S("img",{src:"/bridge/assets/loading.f6990065.svg",alt:"loading"},null,-1),Me={class:"remind"},Ae={class:"remind-tip"},He={class:"remind-tip"},Ie={class:"search-container"},Le=S("i",{class:"search-icon"},null,-1),Be={class:"coin-list"},Ee={class:"flex-y-center"},$e={class:"coin-name"},qe={key:0},Se={key:1,class:"search-no-data flex-y flex-center"},Ue=S("img",{src:F,alt:"no data"},null,-1),_e={class:"bridge-modal-container"},De={class:"transferAmount"},Pe={class:"bridge-modal-info"},Je={class:"receiveAddress"},Oe={class:"bridge-item-value receiveAddress-main"},je={class:"fee flex-between"},We={class:"bridge-item-value"},Fe={class:"receive flex-between"},Ge={class:"bridge-item-value"},Ve={class:"bridge-button"},ze={class:"button-group"};G.render=function(e,a,s,l,t,o){const n=E("el-dialog"),i=E("ModelBridge"),r=E("el-button");return $(),q("div",V,[e.showMain?($(),q("div",z,[S("section",K,[S("div",Q,U(e.t("home.title")),1),S("div",{class:"home-desc",innerHTML:e.t("home.desc")},null,8,["innerHTML"]),S("div",R,[S("div",X,[S("a",Y,U(e.t("home.questions1")),1)]),S("div",Z,[S("a",ee,U(e.t("home.questions2")),1)]),S("div",ae,[S("a",se,U(e.t("home.questions3")),1)])]),S("div",le,U(e.t("home.contract")),1),te]),S("section",oe,[S("div",ne,"* "+U(e.t("home.bridgeTip")),1),S("div",{class:["bridge bridgeTop",{"hb-form-error":e.numberTips}]},[S("div",ie,[_(U(e.t("home.from"))+" ",1),S("div",re,[S("img",{class:"bridge-select-icon",src:"in"===e.type?e.defaultEthImg:e.defaultCubeImg,alt:""+("in"===e.type?"eth":"cube")},null,8,["src","alt"]),_(" "+U("in"===e.type?"ETH":"Cube"),1)]),S("span",ue,U(e.t("home.balance"))+"："+U(e.address?`${e.formatBalance(e.balance,e.currentToken.frontDecimals)} ${e.assetName}`:"-"),1)]),S("div",ce,[S("div",de,[D(S("input",{id:"number","onUpdate:modelValue":a[1]||(a[1]=a=>e.number=a),autocomplete:"off",placeholder:e.t("home.numPlace"),onInput:a[2]||(a[2]=(...a)=>e.handleInput&&e.handleInput(...a))},null,40,["placeholder"]),[[P,e.number]]),e.numberTips?($(),q("div",me,[e.isMobile?($(),q("div",ve,[he,S("div",null,U(e.t(`home.${e.numberTips}`,e.numberTipsParams[e.numberTips])),1)])):($(),q(J,{key:0},[_(U(e.t(`home.${e.numberTips}`,e.numberTipsParams[e.numberTips])),1)],64))])):O("",!0),S("div",{class:"bridge-bottom-max",onClick:a[3]||(a[3]=(...a)=>e.allBalance&&e.allBalance(...a))},U(e.t("home.max")),1)]),S("div",{class:"bridge-select-token",onClick:a[4]||(a[4]=(...a)=>e.showAssetModal&&e.showAssetModal(...a))},[e.assetInfo.icon?($(),q(J,{key:0},[S("img",{src:e.assetInfo.icon||"",alt:"token"},null,8,["src"]),S("span",null,U(e.assetName),1)],64)):($(),q(J,{key:1},[_(U(e.t("home.asset")),1)],64)),be])]),S("div",{class:"transfer",onClick:a[5]||(a[5]=(...a)=>e.changeType&&e.changeType(...a))})],2),S("div",pe,[S("div",fe,[_(U(e.t("home.to"))+" ",1),S("div",ge,[S("img",{class:"bridge-select-icon",src:"in"===e.type?e.defaultCubeImg:e.defaultEthImg,alt:""+("in"===e.type?"cube":"eth")},null,8,["src","alt"]),_(" "+U("in"===e.type?"Cube":"ETH"),1)])]),S("div",ke,[S("div",ye,U(!+e.number||e.numberTips?0:e.getTotal),1)])]),S("div",we,[S("span",Te,U(e.t("home.fee"))+"： "+U(e.address&&e.currentToken?`${e.formatUnits(e.currentToken.fee,e.currentToken.decimal)} ${e.assetName}`:"-"),1),S("span",Ce,U(e.t("home.address"))+"： "+U(e.address?e.compressAddress(e.address):"-"),1)]),e.isBtnLoaded?($(),q("button",Ne,[xe])):($(),q("button",{key:1,class:["hb-button",{noConnect:!e.address}],disabled:e.btnDisabled,onClick:a[6]||(a[6]=(...a)=>e.handleNext&&e.handleNext(...a))},U(e.address?e.isNeedApprove?e.t("wallet.approve"):e.t("common.next"):e.t("wallet.connectWallet")),11,["disabled"])),S("div",Me,U(e.t("home.remind")),1),S("div",Ae,U(e.t("home.remind1")),1),S("div",He,U(e.t("home.remind2")),1)])])):O("",!0),S(n,{visible:e.assetModal,"onUpdate:visible":a[8]||(a[8]=a=>e.assetModal=a),title:e.t("home.asset"),width:"480px",top:"10vh","custom-class":"coin-modal","append-to-body":"","close-on-click-modal":!1,"before-close":e.handleClose},{default:j((()=>[S("div",Ie,[Le,D(S("input",{"onUpdate:modelValue":a[7]||(a[7]=a=>e.tokenName=a),type:"text",placeholder:e.t("home.tokenName")},null,8,["placeholder"]),[[P,e.tokenName,void 0,{trim:!0}]])]),S("div",Be,[e.tokenList.length?($(!0),q(J,{key:0},W(e.tokenList,(a=>($(),q("div",{key:a.id,class:"coin-item",onClick:s=>e.chooseToken(a.symbol)},[S("div",Ee,[S("img",{src:a.icon,alt:"coin"},null,8,["src"]),S("div",$e,U(a.symbol),1)]),a.symbol==e.assetName?($(),q("i",qe)):O("",!0)],8,["onClick"])))),128)):($(),q("div",Se,[Ue,S("div",null,U(e.t("home.noData")),1)]))])])),_:1},8,["visible","title","before-close"]),S(n,{visible:e.bridgeModal,"onUpdate:visible":a[9]||(a[9]=a=>e.bridgeModal=a),title:e.t("home.bridgeConfirm"),width:"480px","append-to-body":"","custom-class":"bridge-modal","close-on-click-modal":!1,"before-close":e.handleCloseBridge},{default:j((()=>[S("div",_e,[S("div",De,U(Number(e.number))+" "+U(e.assetName),1),S(i),S("div",Pe,[S("div",Je,[_(U(e.t("home.address"))+": ",1),S("div",Oe,U(e.address),1)]),S("div",je,[_(U(e.t("home.fee"))+": ",1),S("span",We,U(e.formatUnits(e.currentToken.fee,e.currentToken.decimal))+" "+U(e.assetName),1)]),S("div",Fe,[_(U(e.t("home.receive"))+": ",1),S("span",Ge,U(e.getTotal)+" "+U(e.assetName),1)])]),S("div",Ve,[S(r,{class:"hb_button",loading:e.subLoading,onClick:e.crossChain},{default:j((()=>[_(U(e.t("home.bridgeConfirm")),1)])),_:1},8,["loading","onClick"])])])])),_:1},8,["visible","title","before-close"]),S(n,{visible:e.transferModal,"onUpdate:visible":a[12]||(a[12]=a=>e.transferModal=a),title:e.t("home.transfer"),width:"480px","append-to-body":"","custom-class":"transfer-modal","close-on-click-modal":!1,"before-close":e.handleCloseTransfer},{default:j((()=>[S(i),S("div",{class:"transfer-tips",innerHTML:e.t("home.transferTips"),onClick:a[10]||(a[10]=(...a)=>e.toHistory&&e.toHistory(...a))},null,8,["innerHTML"]),S("div",ze,[S("button",{class:"hb_button goHistory",onClick:a[11]||(a[11]=a=>e.toHistory(null))},U(e.t("common.view")),1)])])),_:1},8,["visible","title","before-close"])])};export default G;
